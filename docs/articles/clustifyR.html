<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to clustifyr • clustifyr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to clustifyr">
<meta property="og:description" content="">
<meta property="og:image" content="http://rnabioco.github.io/clustifyr/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">clustifyr</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="Unreleased version">0.0.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/benchmark.html">Benchmarking clustifyr</a>
    </li>
    <li>
      <a href="../articles/clustifyR.html">Introduction to clustifyr</a>
    </li>
    <li>
      <a href="../articles/download_refs.html">Prebuilt references for clustifyr</a>
    </li>
    <li>
      <a href="../articles/otherformats.html">Support for various single cell object formats</a>
    </li>
    <li>
      <a href="../articles/othertools.html">Other considerations w/ clustifyr</a>
    </li>
    <li>
      <a href="../articles/references.html">Reference building for clustifyr</a>
    </li>
    <li>
      <a href="../articles/visualizations.html">Visualization of clustifyr results</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/rnabioco/clustifyr">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Introduction to clustifyr</h1>
            
            <h4 class="date">2019-11-06</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/rnabioco/clustifyr/blob/master/vignettes/clustifyR.Rmd"><code>vignettes/clustifyR.Rmd</code></a></small>
      <div class="hidden name"><code>clustifyR.Rmd</code></div>

    </div>

    
    
<div id="why-use-clustifyr" class="section level2">
<h2 class="hasAnchor">
<a href="#why-use-clustifyr" class="anchor"></a>Why use <code>clustifyr</code>?</h2>
<p>Single cell transcriptomes are difficult to annotate without extensive knowledge of the underlying biology of the system in question. Even with this knowledge, accurate identification can be challenging due to the lack of detectable expression of common marker genes defined by bulk RNA-seq, flow cytometry, other single cell RNA-seq platforms, etc.</p>
<p><code>clustifyr</code> solves this problem by providing functions to automatically annotate single cells or clusters using bulk RNA-seq data or marker gene lists (ranked or unranked). Additional functions allow for exploratory analysis of calculated similarities between single cell RNA-seq datasets and reference data.</p>
</div>
<div id="a-simple-example-10x-genomics-pbmcs" class="section level2">
<h2 class="hasAnchor">
<a href="#a-simple-example-10x-genomics-pbmcs" class="anchor"></a>A simple example: 10x Genomics PBMCs</h2>
<p>In this example, we take a 10x Genomics 3’ scRNA-seq dataset from peripheral blood mononuclear cells (PBMCs) and annotate the cell clusters (identified using <code>Seurat</code>) using scRNA-seq cell clusters assigned from CITE-seq experiment. The cell types in this dataset have been previously annotated, so this is a good dataset to use for testing the accuracy of <code>clustifyr</code>.</p>
<p>To identify cell types, the <code>clustifyr()</code> function requires several inputs:</p>
<ul>
<li>A matrix of normalized single-cell RNA-seq counts</li>
<li>A meta.data table containing the cluster assignments for each cell</li>
<li>A matrix containing bulk RNA-seq data for each cell type of interest or matrix of mean scRNA-seq expression</li>
<li>A list of genes to use for comparison (optional)</li>
</ul>
<p>Using the <code><a href="../reference/plot_tsne.html">plot_tsne()</a></code> function, we can plot the known identities of each cluster, which were stored in the “classified” column of the meta.data table.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(clustifyr)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(ggplot2)</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(cowplot)</span>
<span id="cb1-4"><a href="#cb1-4"></a></span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="co"># Matrix of normalized single-cell RNA-seq counts</span></span>
<span id="cb1-6"><a href="#cb1-6"></a>full_pbmc_matrix &lt;-<span class="st"> </span>clustifyrdata<span class="op">::</span>pbmc_matrix</span>
<span id="cb1-7"><a href="#cb1-7"></a></span>
<span id="cb1-8"><a href="#cb1-8"></a><span class="co"># meta.data table containing cluster assignments for each cell </span></span>
<span id="cb1-9"><a href="#cb1-9"></a><span class="co"># The table that we are using also contains the known cell identities in the "classified" column</span></span>
<span id="cb1-10"><a href="#cb1-10"></a>full_pbmc_meta &lt;-<span class="st"> </span>clustifyrdata<span class="op">::</span>pbmc_meta</span>
<span id="cb1-11"><a href="#cb1-11"></a></span>
<span id="cb1-12"><a href="#cb1-12"></a><span class="co"># Create tSNE showing known cell identities for each cluster</span></span>
<span id="cb1-13"><a href="#cb1-13"></a><span class="kw"><a href="../reference/plot_tsne.html">plot_tsne</a></span>(</span>
<span id="cb1-14"><a href="#cb1-14"></a>  <span class="dt">data =</span> full_pbmc_meta,  <span class="co"># meta.data table containing UMAP or tSNE data</span></span>
<span id="cb1-15"><a href="#cb1-15"></a>  <span class="dt">feature =</span> <span class="st">"classified"</span>,   <span class="co"># name of column in meta.data to color cells by</span></span>
<span id="cb1-16"><a href="#cb1-16"></a>  <span class="dt">do_label =</span> <span class="ot">TRUE</span>,          <span class="co"># should the feature label be shown on each cluster?</span></span>
<span id="cb1-17"><a href="#cb1-17"></a>  <span class="dt">do_legend =</span> <span class="ot">FALSE</span>         <span class="co"># should the legend be shown?</span></span>
<span id="cb1-18"><a href="#cb1-18"></a>)</span></code></pre></div>
<p><img src="clustifyR_files/figure-html/Load%20data-1.png" width="960" style="display: block; margin: auto;"></p>
</div>
<div id="calculate-correlation-coefficients" class="section level2">
<h2 class="hasAnchor">
<a href="#calculate-correlation-coefficients" class="anchor"></a>Calculate correlation coefficients</h2>
<p>The <code>clustifyr()</code> function returns a matrix of correlation coefficients for each cell type and cluster, with the rownames corresponding to the cluster number.</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a><span class="co"># Calculate correlation coefficients for each cluster (spearman by default)</span></span>
<span id="cb2-2"><a href="#cb2-2"></a>vargenes &lt;-<span class="st"> </span>pbmc_vargenes[<span class="dv">1</span><span class="op">:</span><span class="dv">500</span>]</span>
<span id="cb2-3"><a href="#cb2-3"></a>res &lt;-<span class="st"> </span><span class="kw"><a href="../reference/clustify.html">clustify</a></span>(</span>
<span id="cb2-4"><a href="#cb2-4"></a>  <span class="dt">input =</span> full_pbmc_matrix,     <span class="co"># matrix of normalized single-cell RNA-seq counts</span></span>
<span id="cb2-5"><a href="#cb2-5"></a>  <span class="dt">metadata =</span> full_pbmc_meta,    <span class="co"># meta.data table containing cell clusters</span></span>
<span id="cb2-6"><a href="#cb2-6"></a>  <span class="dt">ref_mat =</span> cbmc_ref,   <span class="co"># matrix of mean scRNA-seq expression data for each cell type</span></span>
<span id="cb2-7"><a href="#cb2-7"></a>  <span class="dt">query_genes =</span> vargenes,  <span class="co"># list of highly varible genes identified with Seurat</span></span>
<span id="cb2-8"><a href="#cb2-8"></a>  <span class="dt">cluster_col =</span> <span class="st">"seurat_clusters"</span>       <span class="co"># name of column in meta.data containing cell clusters</span></span>
<span id="cb2-9"><a href="#cb2-9"></a>)</span>
<span id="cb2-10"><a href="#cb2-10"></a></span>
<span id="cb2-11"><a href="#cb2-11"></a><span class="co"># Peek at correlation matrix</span></span>
<span id="cb2-12"><a href="#cb2-12"></a>res[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">5</span>]</span>
<span id="cb2-13"><a href="#cb2-13"></a><span class="co">#&gt;           B CD14+ Mono CD16+ Mono     CD34+     CD4 T</span></span>
<span id="cb2-14"><a href="#cb2-14"></a><span class="co">#&gt; 0 0.7345444  0.6571888  0.6704756 0.7426868 0.8930064</span></span>
<span id="cb2-15"><a href="#cb2-15"></a><span class="co">#&gt; 1 0.7118115  0.6500660  0.6719955 0.7382099 0.8654573</span></span>
<span id="cb2-16"><a href="#cb2-16"></a><span class="co">#&gt; 2 0.6159989  0.9140277  0.8629032 0.6354744 0.5810497</span></span>
<span id="cb2-17"><a href="#cb2-17"></a><span class="co">#&gt; 3 0.8843411  0.6365743  0.6640880 0.7409892 0.7429827</span></span>
<span id="cb2-18"><a href="#cb2-18"></a><span class="co">#&gt; 4 0.6654634  0.6043520  0.6332612 0.6843847 0.7814971</span></span></code></pre></div>
<p>To visualize the <code>clustifyr()</code> results we can use the <code><a href="../reference/plot_cor_heatmap.html">plot_cor_heatmap()</a></code> function to plot the correlation coefficients for each cluster and each cell type.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a><span class="co"># Create heatmap of correlation coefficients</span></span>
<span id="cb3-2"><a href="#cb3-2"></a><span class="kw"><a href="../reference/plot_cor_heatmap.html">plot_cor_heatmap</a></span>(</span>
<span id="cb3-3"><a href="#cb3-3"></a>  <span class="dt">cor_mat =</span> res  <span class="co"># matrix of correlation coefficients from clustifyr()</span></span>
<span id="cb3-4"><a href="#cb3-4"></a>)</span></code></pre></div>
<p><img src="clustifyR_files/figure-html/Create%20correlation%20heatmap-1.png" width="768" style="display: block; margin: auto;"></p>
</div>
<div id="plot-cluster-identities-and-correlation-coefficients" class="section level2">
<h2 class="hasAnchor">
<a href="#plot-cluster-identities-and-correlation-coefficients" class="anchor"></a>Plot cluster identities and correlation coefficients</h2>
<p><code>clustifyr</code> also provides functions to overlay correlation coefficients on pre-calculated tSNE embeddings (or those from any other dimensionality reduction method).</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a><span class="co"># Overlay correlation coefficients on UMAPs for the first two cell types</span></span>
<span id="cb4-2"><a href="#cb4-2"></a><span class="kw"><a href="../reference/plot_cor.html">plot_cor</a></span>(</span>
<span id="cb4-3"><a href="#cb4-3"></a>  <span class="dt">cor_mat =</span> res,                   <span class="co"># matrix of correlation coefficients from clustifyr()</span></span>
<span id="cb4-4"><a href="#cb4-4"></a>  <span class="dt">metadata =</span> full_pbmc_meta,        <span class="co"># meta.data table containing UMAP or tSNE data</span></span>
<span id="cb4-5"><a href="#cb4-5"></a>  <span class="dt">data_to_plot =</span> <span class="kw"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(res)[<span class="dv">1</span><span class="op">:</span><span class="dv">2</span>],  <span class="co"># name of cell type(s) to plot correlation coefficients</span></span>
<span id="cb4-6"><a href="#cb4-6"></a>  <span class="dt">cluster_col =</span> <span class="st">"seurat_clusters"</span>             <span class="co"># name of column in meta.data containing cell clusters</span></span>
<span id="cb4-7"><a href="#cb4-7"></a>)</span>
<span id="cb4-8"><a href="#cb4-8"></a><span class="co">#&gt; [[1]]</span></span></code></pre></div>
<p><img src="clustifyR_files/figure-html/Overlay%20corr%20coefficients%20on%20UMAP-1.png" width="1152" style="display: block; margin: auto;"></p>
<pre><code>#&gt; 
#&gt; [[2]]</code></pre>
<p><img src="clustifyR_files/figure-html/Overlay%20corr%20coefficients%20on%20UMAP-2.png" width="1152" style="display: block; margin: auto;"></p>
<p>The <code><a href="../reference/plot_best_call.html">plot_best_call()</a></code> function can be used to label each cluster with the cell type that gives the highest corelation coefficient. The plots below show that the highest correlations between the reference RNA-seq data and the 10x Genomics scRNA-seq dataset are restricted to the correct cell clusters.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1"></a><span class="co"># Label clusters with clustifyr cell identities</span></span>
<span id="cb6-2"><a href="#cb6-2"></a>clustifyr_types &lt;-<span class="st"> </span><span class="kw"><a href="../reference/plot_best_call.html">plot_best_call</a></span>(</span>
<span id="cb6-3"><a href="#cb6-3"></a>  <span class="dt">cor_mat =</span> res,             <span class="co"># matrix of correlation coefficients from clustifyr()</span></span>
<span id="cb6-4"><a href="#cb6-4"></a>  <span class="dt">metadata =</span> full_pbmc_meta,    <span class="co"># meta.data table containing UMAP or tSNE data</span></span>
<span id="cb6-5"><a href="#cb6-5"></a>  <span class="dt">do_label =</span> <span class="ot">TRUE</span>,              <span class="co"># should the feature label be shown on each cluster?</span></span>
<span id="cb6-6"><a href="#cb6-6"></a>  <span class="dt">do_legend =</span> <span class="ot">FALSE</span>,            <span class="co"># should the legend be shown?</span></span>
<span id="cb6-7"><a href="#cb6-7"></a>  <span class="dt">cluster_col =</span> <span class="st">"seurat_clusters"</span></span>
<span id="cb6-8"><a href="#cb6-8"></a>) <span class="op">+</span></span>
<span id="cb6-9"><a href="#cb6-9"></a><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span>(<span class="st">"clustifyr cell types"</span>)</span>
<span id="cb6-10"><a href="#cb6-10"></a></span>
<span id="cb6-11"><a href="#cb6-11"></a><span class="co"># Compare clustifyr results with known cell identities</span></span>
<span id="cb6-12"><a href="#cb6-12"></a>known_types &lt;-<span class="st"> </span><span class="kw"><a href="../reference/plot_tsne.html">plot_tsne</a></span>(</span>
<span id="cb6-13"><a href="#cb6-13"></a>  <span class="dt">data =</span> full_pbmc_meta,  <span class="co"># meta.data table containing UMAP or tSNE data</span></span>
<span id="cb6-14"><a href="#cb6-14"></a>  <span class="dt">feature =</span> <span class="st">"classified"</span>,   <span class="co"># name of column in meta.data to color clusters by</span></span>
<span id="cb6-15"><a href="#cb6-15"></a>  <span class="dt">do_label =</span> <span class="ot">TRUE</span>,          <span class="co"># should the feature label be shown on each cluster?</span></span>
<span id="cb6-16"><a href="#cb6-16"></a>  <span class="dt">do_legend =</span> <span class="ot">FALSE</span>         <span class="co"># should the legend be shown?</span></span>
<span id="cb6-17"><a href="#cb6-17"></a>) <span class="op">+</span></span>
<span id="cb6-18"><a href="#cb6-18"></a><span class="st">  </span><span class="kw"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span>(<span class="st">"Known cell types"</span>)</span>
<span id="cb6-19"><a href="#cb6-19"></a></span>
<span id="cb6-20"><a href="#cb6-20"></a><span class="kw"><a href="https://rdrr.io/pkg/cowplot/man/plot_grid.html">plot_grid</a></span>(known_types, clustifyr_types)</span></code></pre></div>
<p><img src="clustifyR_files/figure-html/Label%20clusters-1.png" width="1152" style="display: block; margin: auto;"></p>
</div>
<div id="calculate-correlation-coefficients-on-a-per-cell-basis" class="section level2">
<h2 class="hasAnchor">
<a href="#calculate-correlation-coefficients-on-a-per-cell-basis" class="anchor"></a>Calculate correlation coefficients on a per cell basis</h2>
<p>Correlation coefficients can also be calculated on a per cell basis by setting <code>per_cell = TRUE</code>.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="co"># Calculate correlation coefficients for each cell</span></span>
<span id="cb7-2"><a href="#cb7-2"></a>cell_res &lt;-<span class="st"> </span><span class="kw"><a href="../reference/clustify.html">clustify</a></span>(</span>
<span id="cb7-3"><a href="#cb7-3"></a>  <span class="dt">input =</span> full_pbmc_matrix,     <span class="co"># matrix of normalized single-cell RNA-seq counts</span></span>
<span id="cb7-4"><a href="#cb7-4"></a>  <span class="dt">ref_mat =</span> cbmc_ref,     <span class="co"># matrix of mean scRNA-seq expression data for each cell type</span></span>
<span id="cb7-5"><a href="#cb7-5"></a>  <span class="dt">query_genes =</span> pbmc_vargenes,  <span class="co"># list of highly varible genes identified with Seurat</span></span>
<span id="cb7-6"><a href="#cb7-6"></a>  <span class="dt">per_cell =</span> <span class="ot">TRUE</span></span>
<span id="cb7-7"><a href="#cb7-7"></a>)</span>
<span id="cb7-8"><a href="#cb7-8"></a></span>
<span id="cb7-9"><a href="#cb7-9"></a><span class="co"># Overlay correlation coefficients on UMAPs</span></span>
<span id="cb7-10"><a href="#cb7-10"></a><span class="kw"><a href="../reference/plot_cor.html">plot_cor</a></span>(</span>
<span id="cb7-11"><a href="#cb7-11"></a>  <span class="dt">cor_mat =</span> cell_res,                      <span class="co"># matrix of correlation coefficients from clustifyr()</span></span>
<span id="cb7-12"><a href="#cb7-12"></a>  <span class="dt">metadata =</span> full_pbmc_meta,                <span class="co"># meta.data table containing UMAP or tSNE data</span></span>
<span id="cb7-13"><a href="#cb7-13"></a>  <span class="dt">data_to_plot =</span> <span class="kw"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span>(cell_res)[<span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="dv">1</span>, <span class="dv">5</span>)]  <span class="co"># name of cell type(s) to plot correlation coefficient</span></span>
<span id="cb7-14"><a href="#cb7-14"></a>)</span>
<span id="cb7-15"><a href="#cb7-15"></a><span class="co">#&gt; [[1]]</span></span></code></pre></div>
<p><img src="clustifyR_files/figure-html/Per%20cell%20clustifyr-1.png" width="1152" style="display: block; margin: auto;"></p>
<pre><code>#&gt; 
#&gt; [[2]]</code></pre>
<p><img src="clustifyR_files/figure-html/Per%20cell%20clustifyr-2.png" width="1152" style="display: block; margin: auto;"></p>
</div>
<div id="classify-cells-using-known-marker-genes" class="section level2">
<h2 class="hasAnchor">
<a href="#classify-cells-using-known-marker-genes" class="anchor"></a>Classify cells using known marker genes</h2>
<p>The <code><a href="../reference/clustify_lists.html">clustify_lists()</a></code> function allows cell types to be assigned based on known marker genes. This function requires a table containing markers for each cell type of interest. Cell types can be assigned using several different statistical tests including, hypergeometric, Jaccard, Spearman, and GSEA.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1"></a></span>
<span id="cb9-2"><a href="#cb9-2"></a><span class="co"># Take a peek at marker gene table</span></span>
<span id="cb9-3"><a href="#cb9-3"></a>cbmc_m</span>
<span id="cb9-4"><a href="#cb9-4"></a><span class="co">#&gt;   CD4 T CD8 T Memory CD4 T CD14+ Mono Naive CD4 T   NK     B CD16+ Mono</span></span>
<span id="cb9-5"><a href="#cb9-5"></a><span class="co">#&gt; 1 ITM2A  CD8B        ADCY2     S100A8       CDHR3 GNLY  IGHM     CDKN1C</span></span>
<span id="cb9-6"><a href="#cb9-6"></a><span class="co">#&gt; 2 TXNIP  CD8A       PTGDR2     S100A9  DICER1-AS1 NKG7 CD79A       HES4</span></span>
<span id="cb9-7"><a href="#cb9-7"></a><span class="co">#&gt; 3   AES S100B      CD200R1        LYZ       RAD9A CST7 MS4A1        CKB</span></span>
<span id="cb9-8"><a href="#cb9-8"></a><span class="co">#&gt;      CD34+ Eryth    Mk    DC   pDCs</span></span>
<span id="cb9-9"><a href="#cb9-9"></a><span class="co">#&gt; 1   SPINK2   HBM   PF4  ENHO LILRA4</span></span>
<span id="cb9-10"><a href="#cb9-10"></a><span class="co">#&gt; 2  C1QTNF4  AHSP  SDPR  CD1E   TPM2</span></span>
<span id="cb9-11"><a href="#cb9-11"></a><span class="co">#&gt; 3 KIAA0125   CA1 TUBB1 NDRG2    SCT</span></span>
<span id="cb9-12"><a href="#cb9-12"></a></span>
<span id="cb9-13"><a href="#cb9-13"></a><span class="co"># Available metrics include: "hyper", "jaccard", "spearman", "gsea"</span></span>
<span id="cb9-14"><a href="#cb9-14"></a>list_res &lt;-<span class="st"> </span><span class="kw"><a href="../reference/clustify_lists.html">clustify_lists</a></span>(</span>
<span id="cb9-15"><a href="#cb9-15"></a>  <span class="dt">input =</span> full_pbmc_matrix,       <span class="co"># matrix of normalized single-cell RNA-seq counts</span></span>
<span id="cb9-16"><a href="#cb9-16"></a>  <span class="dt">metadata =</span> full_pbmc_meta,  <span class="co"># meta.data table containing cell clusters</span></span>
<span id="cb9-17"><a href="#cb9-17"></a>  <span class="dt">cluster_col =</span> <span class="st">"seurat_clusters"</span>,          <span class="co"># name of column in meta.data containing cell clusters</span></span>
<span id="cb9-18"><a href="#cb9-18"></a>  <span class="dt">marker =</span> cbmc_m,                  <span class="co"># list of known marker genes</span></span>
<span id="cb9-19"><a href="#cb9-19"></a>  <span class="dt">metric =</span> <span class="st">"hyper"</span>                  <span class="co"># test to use for assigning cell types</span></span>
<span id="cb9-20"><a href="#cb9-20"></a>)</span>
<span id="cb9-21"><a href="#cb9-21"></a></span>
<span id="cb9-22"><a href="#cb9-22"></a><span class="co"># view as heatmap, or plot_best_call</span></span>
<span id="cb9-23"><a href="#cb9-23"></a><span class="kw"><a href="../reference/plot_cor_heatmap.html">plot_cor_heatmap</a></span>(</span>
<span id="cb9-24"><a href="#cb9-24"></a>  <span class="dt">cor_mat =</span> list_res,         <span class="co"># matrix of correlation coefficients from clustify_lists()</span></span>
<span id="cb9-25"><a href="#cb9-25"></a>  <span class="dt">col =</span> not_pretty_palette,      <span class="co"># colors to use for heatmap</span></span>
<span id="cb9-26"><a href="#cb9-26"></a>  <span class="dt">cluster_rows =</span> <span class="ot">FALSE</span>,          <span class="co"># cluster by row?</span></span>
<span id="cb9-27"><a href="#cb9-27"></a>  <span class="dt">cluster_columns =</span> <span class="ot">FALSE</span>,       <span class="co"># cluster by column?</span></span>
<span id="cb9-28"><a href="#cb9-28"></a>  <span class="dt">legend_title =</span> <span class="st">"-log10(padj)"</span>  <span class="co"># title of heatmap legend</span></span>
<span id="cb9-29"><a href="#cb9-29"></a>)</span></code></pre></div>
<p><img src="clustifyR_files/figure-html/clustifyr%20with%20gene%20lists-1.png" width="576" style="display: block; margin: auto;"></p>
<hr>
</div>
<div id="direct-handling-of-seurat-v2-and-v3-objects" class="section level2">
<h2 class="hasAnchor">
<a href="#direct-handling-of-seurat-v2-and-v3-objects" class="anchor"></a>Direct handling of <code>seurat</code> v2 and v3 objects</h2>
<p><code>clustifyr()</code> can also use a <code>Seurat</code> object as input and return a new <code>Seurat</code> object with the cell types added as a column in the meta.data.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">

        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#why-use-clustifyr">Why use <code>clustifyr</code>?</a></li>
      <li><a href="#a-simple-example-10x-genomics-pbmcs">A simple example: 10x Genomics PBMCs</a></li>
      <li><a href="#calculate-correlation-coefficients">Calculate correlation coefficients</a></li>
      <li><a href="#plot-cluster-identities-and-correlation-coefficients">Plot cluster identities and correlation coefficients</a></li>
      <li><a href="#calculate-correlation-coefficients-on-a-per-cell-basis">Calculate correlation coefficients on a per cell basis</a></li>
      <li><a href="#classify-cells-using-known-marker-genes">Classify cells using known marker genes</a></li>
      <li><a href="#direct-handling-of-seurat-v2-and-v3-objects">Direct handling of <code>seurat</code> v2 and v3 objects</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by Rui Fu, Kent Riemondy, Austin Gillen, Chengzhe Tian, Jay Hesselberth.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
